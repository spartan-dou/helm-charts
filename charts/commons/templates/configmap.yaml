{{- $components := include "commons.withAddons" . | fromYamlArray }}
{{- range $components }}
{{- $component := . }}
{{- with $component.configMap }}
{{- range $i, $configmap := . }}
apiVersion: v1
kind: ConfigMap
metadata:
  name: {{ include "commons.fullname" (dict "Chart" $.Chart "Values" $.Values "Release" $.Release "name" (default (printf "configmap-%d" $i) $configmap.name) "component" $component) }}
  labels:
    {{ include "commons.labels" (dict "Chart" $.Chart "Values" $.Values "Release" $.Release "name" (default (printf "configmap-%d" $i) $configmap.name) "component" $component) | nindent 4 }}
data:
  {{- range $filename, $content := $configmap.data }}
  {{ $filename }}: |-
  {{ $content | indent 2 }}
  {{- end }}
{{- end }}
{{- end }}
{{- end }}