nameOverride: ""
fullname: ""
timezone: "Europe/Paris"

components:
  - name: web
    deployment:
      replicas: 2
      initContainers:
        containers:
          - name: setup-volume
            image: alpine
            command: ['sh', '-c', 'mkdir -p /data/init']
      name: nginx
      image: nginx:stable
      ports:
        - name: http
          containerPort: 80
      env:
        - name: ENV
          value: prod
      livenessProbe:
        httpGet:
          path: /health
          port: 8080
        initialDelaySeconds: 10
        periodSeconds: 5
      readinessProbe:
        httpGet:
          path: /ready
          port: 8080
        initialDelaySeconds: 5
        periodSeconds: 3
      startupProbe:
        httpGet:
          path: /startup
          port: 8080
        failureThreshold: 30
        periodSeconds: 10
      volumeMounts:
        - name: config
          mountPath: /etc/config
    service:
      enabled: true
      type: ClusterIP
      annotations:
        metallb.universe.tf/address-pool: "default"
        prometheus.io/scrape: "true"
      ports:
        - name: http
          port: 80
          targetPort: 8080
    ingress:
      enabled: true
      className: nginx
      annotations:
        nginx.ingress.kubernetes.io/rewrite-target: /
      hosts:
        - host: web.mondomaine.local
          paths:
            - path: /
              pathType: Prefix
      tls:
        - hosts:
            - web.mondomaine.local
          secretName: web-cert
    pvc:
      - name: data
        accessModes: [ReadWriteOnce]
        storage: 1Gi
        storageClassName: local-path
    postgres:
      - name: postgres
        tag: 16
        storage:
          size: 1Gi
          storageClass: local-path
        cluster:
          username: changeme
          password: changeme
        init:
          databases:
            - name: analytics
              owner: analyst
              password: securepass


addons:
  vscode:
    enabled: true
  redis:
    enabled: true
    name: redis
    image: bitnami/redis
    port: 6379
    password: changeme
    resources:
      limits:
        cpu: 100m
        memory: 128Mi