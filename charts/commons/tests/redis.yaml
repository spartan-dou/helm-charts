suite: Tests complets du chart commons
templates:
  - templates/addons/redis/secret.yaml
  - templates/deployment.yaml
  - templates/services.yaml

tests:
  # --- Secrets ---
  - it: Vérifie le Secret Redis
    documentSelector:
      kind: Secret
      metadata:
        name: test-commons-secret
    asserts:
      - equal:
          path: type
          value: Opaque
      - equal:
          path: data.password
          value: Y2hhbmdlbWU=
  # --- Deployments ---
  - it: Vérifie le Deployment redis
    documentSelector:
      kind: Deployment
      metadata:
        name: test-commons
    asserts:
      - equal:
          path: spec.replicas
          value: 1
      - equal:
          path: spec.template.spec.containers[0].image
          value: bitnami/redis:8.2.1
 # --- Services ---
  - it: Vérifie le Service redis
    documentSelector:
      kind: Service
      metadata:
        name: test-commons-redis
    asserts:
      - equal:
          path: spec.ports[0].port
          value: 6379
      - equal:
          path: spec.selector.app
          value: redis