suite: Tests complets du chart commons
release:
  name: test
tests:
  # --- Cluster CNPG ---
  - it: Vérifie le Cluster Postgres
    templates:
      - templates/cnpg/cluster.yaml
    documentSelector:
      path: metadata.name
      value: test
    asserts:
      - equal:
          path: spec.instances
          value: 1
      - equal:
          path: spec.imageName
          value: ghcr.io/cloudnative-pg/postgresql:16

  # --- ConfigMap ---
  - it: Vérifie le ConfigMap init-sql
    templates:
      - templates/cnpg/init-sql.yaml
    documentSelector:
      path: metadata.name
      value: test-postgres-configmap
    asserts:
      - equal:
          path: kind
          value: ConfigMap
      - equal:
          path: metadata.name
          value: test-postgres-configmap
      - matchRegex:
          path: data.init.sql
          pattern: 'echo "toto"'
