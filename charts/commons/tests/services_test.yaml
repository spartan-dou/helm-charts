# yaml-language-server: $schema=https://raw.githubusercontent.com/helm-unittest/helm-unittest/main/schema/helm-testsuite.json
suite: Tests complets du chart commons
templates:
  - templates/services.yaml
set:
  Release.Name: test
tests:
  # --- Services ---
  - it: Vérifie le Service web
    documentSelector:
      path: metadata.name
      value: test-nginx
    asserts:
      - equal:
          path: spec.ports[0].port
          value: 80
      - equal:
          path: spec.ports[0].targetPort
          value: 8080
      - equal:
          path: spec.selector.app
          value: web

  - it: Vérifie le Service vscode
    documentSelector:
      path: metadata.name
      value: test-vscode
    asserts:
      - equal:
          path: spec.ports[0].port
          value: 8080
      - equal:
          path: spec.selector.app
          value: vscode

  - it: Vérifie le Service redis
    documentSelector:
      path: metadata.name
      value: test-redis
    asserts:
      - equal:
          path: spec.ports[0].port
          value: 6379
      - equal:
          path: spec.selector.app
          value: redis