{{- $components := include "commons.withAddons" . | fromYamlArray }}
{{- $raw := .Values.addons | default dict }}
{{- $components = append $components $raw }}
{
    "Servers": {
{{- range $i, $c := $components }}
{{- $component := $c }}
{{- with $component.postgres }}
{{- if .enabled }}
        "{{ $i }}": {
            "Name": "{{ $component.name }}",
            "Group": "{{ $.Release.Name }}",
            "Port": 5432,
            "Username": "{{ include 'commons.getValue' (dict 'Values' $.Values 'Chart' $.Chart 'Release' $.Release 'component' $component 'value' '__component__postgres__username') }}",
            "Host": "{{ include 'commons.getValue' (dict 'Values' $.Values 'Chart' $.Chart 'Release' $.Release 'component' $component 'value' '__component__postgres__host') }}",
            "MaintenanceDB": "postgres",
            "PassFile": "/pgpass"
        },
{{- end }}
{{- end }}
{{- end }}
    }
}